//
//  InstitutionTests.swift
//  BalanceOpenTests
//
//  Created by Raimon Lapuente on 08/08/2017.
//  Copyright Â© 2017 Balanced Software, Inc. All rights reserved.
//

import XCTest
@testable import BalanceOpen

// Tests won't work until we enable de database for testing
// then we just add test before each func name

class InstitutionTests: XCTestCase {

    override func setUp() {
        super.setUp()
    }
    
    override func tearDown() {
        Institution.allInstitutions().forEach { (institution) in
            institution.remove()
        }
        super.tearDown()
    }

    func InstitutionCreation() {
        //given
        let institution = Institution(sourceId: .poloniex, sourceInstitutionId: "", name: "Poloniex", nameBreak: nil, primaryColor: .green, secondaryColor: nil, logoData: nil, accessToken: nil)
        
        //then
        XCTAssertEqual(institution?.name, "Poloniex")
    }

    func InstitutionStorage() {
        //given
        _ = Institution(sourceId: .poloniex, sourceInstitutionId: "", name: "Poloniex", nameBreak: nil, primaryColor: .green, secondaryColor: nil, logoData: nil, accessToken: nil)

        //then
        let institutionsFromMemory = Institution.allInstitutions()
        let institution = institutionsFromMemory.first
        XCTAssertEqual(institution?.name, "Poloniex")
    }

    func PoloniexCredentials() {
        //given
        let institution = Institution(sourceId: .poloniex, sourceInstitutionId: "", name: "Poloniex", nameBreak: nil, primaryColor: .green, secondaryColor: nil, logoData: nil, accessToken: nil)
        XCTAssertNil(institution?.apiKey)
        XCTAssertNil(institution?.secret)
        
        //when
        institution?.apiKey = "key"
        institution?.secret = "somesecret"
        
        //then
        XCTAssertEqual(institution?.apiKey, "key")
        XCTAssertEqual(institution?.secret, "somesecret")
    }
}
